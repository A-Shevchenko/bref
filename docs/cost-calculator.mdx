import { useState } from 'react';
export const introduction = 'Calculate the costs of running your PHP application on AWS Lambda.';

# Serverless costs calculator

Use the calculator below to estimate the costs of running your PHP application on AWS Lambda.

<Calculator />

export function Calculator() {
    const lambdaFreeTierRequests = 1000000;
    const lambdaFreeTierDuration = 400000;
    const lambdaCostPerRequest = 0.2 / 1000000;
    const lambdaCostPerGbS = 0.0000133334; // ARM

    const apiGatewayFreeTierRequests = 1000000;
    const apiGatewayCostPerRequest = 1 / 1000000;

    const sqsFreeTierRequests = 1000000;
    const sqsCostPerRequest = 0.4 / 1000000;

    const rdsStorageFreeTier = 20;
    const rdsStorageCostPerGb = 0.115;
    const rdsInstanceCost = {
        'db.t4g.micro': 0.016,
        'db.t4g.small': 0.032,
        'db.t4g.medium': 0.065,
        'db.t4g.large': 0.129,
        'db.t4g.xlarge': 0.258,
        'db.t4g.2xlarge': 0.517,
    };
    const rdsInstanceDescription = {
        'db.t4g.micro': '1 vCPU, 1GB RAM',
        'db.t4g.small': '1 vCPU, 2GB RAM',
        'db.t4g.medium': '2 vCPU, 4GB RAM',
        'db.t4g.large': '2 vCPU, 8GB RAM',
        'db.t4g.xlarge': '4 vCPU, 16GB RAM',
        'db.t4g.2xlarge': '8 vCPU, 32GB RAM',
    };
    const natGatewayCost = 0.045 * 24 * 30;
    const natInstanceCost = 0.0042 * 24 * 30;

    const [ httpRequests, setHttpRequests ] = useState(10000);
    const [ httpDuration, setHttpDuration ] = useState(100);
    const [ jobs, setJobs ] = useState(0);
    const [ database, setDatabase ] = useState(undefined);
    const [ databaseSize, setDatabaseSize ] = useState(20);
    const [ natType, setNatType ] = useState('natInstance');
    const [ jobDuration, setJobDuration ] = useState(50);

    // Calculate costs
    const lambdaInvocations = Number(httpRequests) + Number(jobs);
    const lambdaGbS = httpRequests * httpDuration / 1000 + jobs * jobDuration / 1000;
    const lambdaCost = Math.max(0, (lambdaInvocations - lambdaFreeTierRequests) * lambdaCostPerRequest)
        + Math.max(0, (lambdaGbS - lambdaFreeTierDuration) * lambdaCostPerGbS);
    const apiGatewayCost = Math.max(0, (httpRequests - apiGatewayFreeTierRequests) * apiGatewayCostPerRequest);
    const numberOfSqsRequestsPerJob = 3; // Send, receive, delete
    const sqsCost = Math.max(0, (jobs * numberOfSqsRequestsPerJob - sqsFreeTierRequests) * sqsCostPerRequest);
    const rdsCost = database ? rdsInstanceCost[database] * 24 * 30 + Math.max(0, (databaseSize - rdsStorageFreeTier) * rdsStorageCostPerGb) : 0;
    const natCost = (database && natType) ? (natType === 'natInstance' ? natInstanceCost : natGatewayCost) : 0;

    const totalCost = lambdaCost + apiGatewayCost + sqsCost + rdsCost + natCost;

    function smallApi() {
        setHttpRequests(10000);
        setHttpDuration(100);
    }
    function largeApi() {
        setHttpRequests(5000000);
        setHttpDuration(100);
    }
    function smallWebsite() {
        setHttpRequests(10000);
        setHttpDuration(200);
    }
    function largeWebsite() {
        setHttpRequests(5000000);
        setHttpDuration(200);
    }

    return (
        <div className="mt-6">
            <Section title="Presets">
                <div className="mt-4 grid grid-cols-4 gap-4">
                    <Button onClick={smallApi}>Small API</Button>
                    <Button onClick={largeApi}>Large API</Button>
                    <Button onClick={smallWebsite}>Small website</Button>
                    <Button onClick={largeWebsite}>Large website</Button>
                </div>
            </Section>

            <Section title="HTTP backend (assets excluded)">
                <Field title="HTTP requests per month">
                    <InputField type="number" value={httpRequests} valueSetter={setHttpRequests} />
                </Field>
                <Field title="Average execution time (ms)">
                    <InputField type="number" value={httpDuration} valueSetter={setHttpDuration} />
                </Field>
            </Section>

            <Section title="Asynchronous jobs">
                <Field title="Jobs per month">
                    <InputField type="number" value={jobs} valueSetter={setJobs} />
                </Field>
                <Field title="Average execution time per job (ms)">
                    <InputField type="number" value={jobDuration} valueSetter={setJobDuration} />
                </Field>
            </Section>

            <Section title="Database (MySQL or PostgreSQL)">
                <Field title="Instance size">
                    <SelectField value={database} valueSetter={setDatabase}>
                        <option value="">None</option>
                        {Object.entries(rdsInstanceDescription)
                            .map(([instance, description]) => <option value={instance}>{description} ({instance})</option>)}
                    </SelectField>
                </Field>
                {database && <Field title="Database size (storage in GB)">
                    <InputField type="number" value={databaseSize} valueSetter={setDatabaseSize} />
                </Field>}
                {database && <Field title="NAT Gateway type">
                    <SelectField value={natType} valueSetter={setNatType}>
                        <option value="natInstance">NAT instance (for smaller applications)</option>
                        <option value="natGateway">Managed NAT Gateway (intensive production workloads)</option>
                        <option value="">None (database outside a VPC)</option>
                    </SelectField>
                </Field>}
            </Section>

            <Section title="Monthly costs (free tier included)">
                <Field title="AWS Lambda costs">
                    <PlainTextField>${lambdaCost.toFixed(2)}</PlainTextField>
                </Field>
                <div className="text-xs text-gray-500 pb-1.5 sm:pb-2">
                    Assumptions: 1024MB of memory (Bref default config) and ARM CPUs.
                </div>
                <Field title="API Gateway costs">
                    <PlainTextField>${apiGatewayCost.toFixed(2)}</PlainTextField>
                </Field>
                <div className="text-xs text-gray-500 pb-1.5 sm:pb-2">
                    Assumptions: API Gateway v2.
                </div>
                {jobs > 0 && <Field title="SQS costs">
                    <PlainTextField>${sqsCost.toFixed(2)}</PlainTextField>
                </Field>}
                {jobs > 0 && <div className="text-xs text-gray-500 pb-1.5 sm:pb-2">
                    Assumptions: Standard SQS queue.
                </div>}
                {database && <Field title="Database costs">
                    <PlainTextField>${rdsCost.toFixed(2)}</PlainTextField>
                </Field>}
                {database && <div className="text-xs text-gray-500 pb-1.5 sm:pb-2">
                    Costs vary depending on the use case. Aurora Serverless can be considered, as well as reserved RDS instances for lower costs.
                    {' '}
                    <a href="/docs/environment/database-planetscale">PlanetScale</a> can also be considered as an alternative to RDS.
                </div>}
                {database && <Field title="NAT Gateway costs">
                    <PlainTextField>${natCost.toFixed(2)}</PlainTextField>
                </Field>}
                {database && <div className="text-xs text-gray-500 pb-1.5 sm:pb-2">
                    NAT Gateway is necessary when using a database in a private VPC (virtual network).
                    Data transfer cost is excluded.
                </div>}
            </Section>

            <Section title={`Total costs: $${totalCost.toFixed(2)}/month`}>
            </Section>
        </div>
    )
}

export function Section({ children, title, ...props }) {
    return <>
        <h2 className="mt-8 text-base font-bold leading-7 pb-2 border-b border-gray-900/10">
            {title}
        </h2>
        <div className="mt-2 space-y-8 pb-12 sm:space-y-0 sm:pb-0">
            {children}
        </div>
    </>
}

export function Field({ children, title, ...props }) {
    return <div className="sm:grid sm:grid-cols-5 sm:items-start sm:gap-4 sm:py-2">
        <label className="block sm:col-span-2 text-sm font-medium leading-6 sm:pt-1.5">
            {title}
        </label>
        <div className="mt-2 sm:col-span-3 sm:mt-0">
            {children}
        </div>
    </div>
}

export function Button({ children, ...props }) {
    return <button
        className="inline-flex justify-center rounded-md bg-blue-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-blue-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-blue-600"
        {...props}
    >
        {children}
    </button>
}

export function InputField({ children, value, valueSetter, ...props }) {
    return <input {...props} className="block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:max-w-xs sm:text-sm sm:leading-6"
                  value={value}
                  onChange={e => valueSetter(e.target.value)}/>
}

export function SelectField({ children, value, valueSetter, ...props }) {
    return <select type="text" {...props} className="block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:max-w-xs sm:text-sm sm:leading-6"
                  value={value}
                  onChange={e => valueSetter(e.target.value)}>{children}</select>;
}

export function PlainTextField({ children, ...props }) {
    return <div {...props} className="py-1.5 sm:text-sm sm:leading-6">
        {children}
    </div>
}
